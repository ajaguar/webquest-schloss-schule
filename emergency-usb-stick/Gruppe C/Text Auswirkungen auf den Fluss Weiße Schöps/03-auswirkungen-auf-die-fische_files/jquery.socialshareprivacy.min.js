/*
 * jquery.socialshareprivacy.js | 2 Klicks fuer mehr Datenschutz
 *
 * http://www.heise.de/extras/socialshareprivacy/
 * http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html
 *
 * Copyright (c) 2011 Hilko Holweg, Sebastian Hilbig, Nicolas Heiringhoff, Juergen Schmidt,
 * Heise Zeitschriften Verlag GmbH & Co. KG, http://www.heise.de
 *
 * Support für Barrierefreiheit durch exozet GmbH
 *
 * is released under the MIT License http://www.opensource.org/licenses/mit-license.php
 *
 * Spread the word, link to us if you can.
 */
(function(e){function t(e,t){var n=decodeURIComponent(e);if(n.length<=t)return e;var r=n.substring(0,t-1).lastIndexOf(" ");return n=encodeURIComponent(n.substring(0,r))+"â€¦"}function n(t){return e('meta[name="'+t+'"]').attr("content")||""}function r(){var t=n("DC.title"),r=n("DC.creator"),t=0<t.length&&0<r.length?t+(" - "+r):e("title").text();return encodeURIComponent(t)}function i(){var t=document.location.href,n=e("link[rel=canonical]").attr("href");n&&0<n.length&&(0>n.indexOf("http")&&(n=document.location.protocol+"//"+document.location.host+n),t=n);return t}e.fn.socialSharePrivacy=function(n){var o=e.extend(!0,{services:{facebook:{status:"on",dummy_img:"/rbb/grafik/socialshare/dummy_facebook.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Facebook senden. Schon beim Aktivieren werden Daten an Dritte übertragen - siehe Link Datenschutz.",txt_fb_off:"nicht mit Facebook verbunden",txt_fb_on:"mit Facebook verbunden",perma_option:"on",display_name:"Facebook",referrer_track:"",language:"de_DE",action:"recommend"},twitter:{status:"on",dummy_img:"/rbb/grafik/socialshare/dummy_twitter.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Twitter senden. Schon beim Aktivieren werden Daten an Dritte übertragen - siehe Link Datenschutz.",txt_twitter_off:"nicht mit Twitter verbunden",txt_twitter_on:"mit Twitter verbunden",perma_option:"on",display_name:"Twitter",referrer_track:"",tweet_text:r,language:"en"},gplus:{status:"on",dummy_img:"/rbb/grafik/socialshare/dummy_gplus.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Google+ senden. Schon beim Aktivieren werden Daten an Dritte übertragen - siehe Link Datenschutz.",txt_gplus_off:"nicht mit Google+ verbunden",txt_gplus_on:"mit Google+ verbunden",perma_option:"on",display_name:"Google+",referrer_track:"",language:"de"}},info_link:"http://www.rbb-online.de/unternehmen/der_rbb/struktur/datenschutz/integration-von-social-media-angeboten.html",txt_help:"Wenn Sie diese Felder durch einen Klick aktivieren, werden Informationen an Facebook, Twitter oder Google in die USA übertragen und unter Umständen auch dort gespeichert. Näheres erfahren Sie durch einen Klick auf das <em>i</em>.",settings_perma:"Dauerhaft aktivieren und Datenübera­tragung zustimmen:",cookie_path:"/",cookie_domain:document.location.host,cookie_expires:"365",css_path:"css/socialshareprivacy.css",uri:i},n),u="on"===o.services.facebook.status,a="on"===o.services.twitter.status,f="on"===o.services.gplus.status;if(u||a||f)return 0<o.css_path.length&&(document.createStyleSheet?document.createStyleSheet(o.css_path):e("head").append('<link rel="stylesheet" type="text/css" href="'+o.css_path+'" />')),this.each(function(){e(this).prepend('<ul class="social_share_privacy_area"></ul>');var n=e(".social_share_privacy_area",this),r=o.uri;"function"===typeof r&&(r=r(n));if(u){var i=encodeURIComponent(r+o.services.facebook.referrer_track),s='<iframe src="http://www.facebook.com/plugins/like.php?locale='+o.services.facebook.language+"&href="+i+"&send=false&layout=button_count&width=120&show_faces=false&action="+o.services.facebook.action+'&colorscheme=light&font&height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:145px; height:21px;" allowTransparency="true"></iframe>',l='<img src="'+o.services.facebook.dummy_img+'" alt="Facebook "Like"-Dummy" class="fb_like_privacy_dummy" />';n.append('<li class="facebook help_info"><span class="info">'+o.services.facebook.txt_info+'</span><span class="switch off" tabindex="0">'+o.services.facebook.txt_fb_off+'</span><div class="fb_like dummy_btn">'+l+"</div></li>");var c=e("li.facebook",n);e("li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook",n).on("click","span.switch",function(){c.find("span.switch").hasClass("off")?(c.addClass("info_off"),c.find("span.switch").addClass("on").removeClass("off").html(o.services.facebook.txt_fb_on),c.find("img.fb_like_privacy_dummy").replaceWith(s)):(c.removeClass("info_off"),c.find("span.switch").addClass("off").removeClass("on").html(o.services.facebook.txt_fb_off),c.find(".fb_like").html(l))});e("li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook",n).on("keyup","span.switch",function(e){if(e.keyCode==13){c.find("span.switch").hasClass("off")?(c.addClass("info_off"),c.find("span.switch").addClass("on").removeClass("off").html(o.services.facebook.txt_fb_on),c.find("img.fb_like_privacy_dummy").replaceWith(s)):(c.removeClass("info_off"),c.find("span.switch").addClass("off").removeClass("on").html(o.services.facebook.txt_fb_off),c.find(".fb_like").html(l))}})}if(a){i=o.services.twitter.tweet_text;"function"===typeof i&&(i=i());var i=t(i,"120"),h=encodeURIComponent(r+o.services.twitter.referrer_track),p=encodeURIComponent(r),d='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url='+h+"&counturl="+p+"&text="+i+"&count=horizontal&lang="+o.services.twitter.language+'" style="width:130px; height:25px;"></iframe>',v='<img src="'+o.services.twitter.dummy_img+'" alt=""Tweet this"-Dummy" class="tweet_this_dummy" />';n.append('<li class="twitter help_info"><span class="info">'+o.services.twitter.txt_info+'</span><span class="switch off" tabindex="0">'+o.services.twitter.txt_twitter_off+'</span><div class="tweet dummy_btn">'+v+"</div></li>");var m=e("li.twitter",n);e("li.twitter div.tweet img,li.twitter",n).on("click","span.switch",function(){m.find("span.switch").hasClass("off")?(m.addClass("info_off"),m.find("span.switch").addClass("on").removeClass("off").html(o.services.twitter.txt_twitter_on),m.find("img.tweet_this_dummy").replaceWith(d)):(m.removeClass("info_off"),m.find("span.switch").addClass("off").removeClass("on").html(o.services.twitter.txt_twitter_off),m.find(".tweet").html(v))});e("li.twitter div.tweet img,li.twitter",n).on("keyup","span.switch",function(e){if(e.keyCode==13){m.find("span.switch").hasClass("off")?(m.addClass("info_off"),m.find("span.switch").addClass("on").removeClass("off").html(o.services.twitter.txt_twitter_on),m.find("img.tweet_this_dummy").replaceWith(d)):(m.removeClass("info_off"),m.find("span.switch").addClass("off").removeClass("on").html(o.services.twitter.txt_twitter_off),m.find(".tweet").html(v))}})}if(f){var g='<div class="g-plusone" data-size="medium" data-href="'+(r+o.services.gplus.referrer_track)+'"></div><script type="text/javascript">window.___gcfg = {lang: "'+o.services.gplus.language+'"}; (function() { var po = document.createElement("script"); po.type = "text/javascript"; po.async = true; po.src = "https://apis.google.com/js/plusone.js"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s); })(); </script>',y='<img src="'+o.services.gplus.dummy_img+'" alt=""Google+1"-Dummy" class="gplus_one_dummy" />';n.append('<li class="gplus help_info"><span class="info">'+o.services.gplus.txt_info+'</span><span class="switch off" tabindex="0">'+o.services.gplus.txt_gplus_off+'</span><div class="gplusone dummy_btn">'+y+"</div></li>");var w=e("li.gplus",n);e("li.gplus div.gplusone img,li.gplus",n).on("click","span.switch",function(){w.find("span.switch").hasClass("off")?(w.addClass("info_off"),w.find("span.switch").addClass("on").removeClass("off").html(o.services.gplus.txt_gplus_on),w.find("img.gplus_one_dummy").replaceWith(g)):(w.removeClass("info_off"),w.find("span.switch").addClass("off").removeClass("on").html(o.services.gplus.txt_gplus_off),w.find(".gplusone").html(y))});e("li.gplus div.gplusone img,li.gplus",n).on("keyup","span.switch",function(e){if(e.keyCode==13){w.find("span.switch").hasClass("off")?(w.addClass("info_off"),w.find("span.switch").addClass("on").removeClass("off").html(o.services.gplus.txt_gplus_on),w.find("img.gplus_one_dummy").replaceWith(g)):(w.removeClass("info_off"),w.find("span.switch").addClass("off").removeClass("on").html(o.services.gplus.txt_gplus_off),w.find(".gplusone").html(y))}})}n.append('<li class="settings_info"><div class="settings_info_menu off perma_option_off"><a href="'+o.info_link+'">Datenschutz<!--<span class="help_info icon"><span class="info">'+o.txt_help+"</span></span>--></a></div></li>");e(".help_info:not(.info_off)",n).on("mouseenter",function(){var t=e(this),n=window.setTimeout(function(){e(t).addClass("display")},500);e(this).data("timeout_id",n)});e(".help_info",n).on("mouseleave",function(){var t=e(this).data("timeout_id");window.clearTimeout(t);e(this).hasClass("display")&&e(this).removeClass("display")});r="on"===o.services.facebook.perma_option;i="on"===o.services.twitter.perma_option;h="on"===o.services.gplus.perma_option;if((u&&r||a&&i||f&&h)&&(!e.browser.msie||e.browser.msie&&7<e.browser.version)){for(var E=document.cookie.split(";"),p="{",S=0;S<E.length;S+=1){var T=E[S].split("="),p=p+('"'+e.trim(T[0])+'":"'+e.trim(T[1])+'"');S<E.length-1&&(p+=",")}var p=JSON.parse(p+"}"),N=e("li.settings_info",n);N.find(".settings_info_menu").removeClass("perma_option_off");N.find(".settings_info_menu").append('<span class="settings">Einstellungen</span><form><fieldset><legend>'+o.settings_perma+"</legend></fieldset></form>");u&&r&&(E="perma_on"===p.socialSharePrivacy_facebook?' checked="checked"':"",N.find("form fieldset").append('<input type="checkbox" name="perma_status_facebook" id="perma_status_facebook"'+E+' /><label for="perma_status_facebook">'+o.services.facebook.display_name+"</label>"));a&&i&&(E="perma_on"===p.socialSharePrivacy_twitter?' checked="checked"':"",N.find("form fieldset").append('<input type="checkbox" name="perma_status_twitter" id="perma_status_twitter"'+E+' /><label for="perma_status_twitter">'+o.services.twitter.display_name+"</label>"));f&&h&&(E="perma_on"===p.socialSharePrivacy_gplus?' checked="checked"':"",N.find("form fieldset").append('<input type="checkbox" name="perma_status_gplus" id="perma_status_gplus"'+E+' /><label for="perma_status_gplus">'+o.services.gplus.display_name+"</label>"));N.find("span.settings").css("cursor","pointer");e(N.find("span.settings"),n).on("mouseenter",function(){var t=window.setTimeout(function(){N.find(".settings_info_menu").removeClass("off").addClass("on")},500);e(this).data("timeout_id",t)});e(N,n).on("mouseleave",function(){var t=e(this).data("timeout_id");window.clearTimeout(t);N.find(".settings_info_menu").removeClass("on").addClass("off")});e(N.find("fieldset input")).on("click",function(t){var r=t.target.id,i="socialSharePrivacy_"+r.substr(r.lastIndexOf("_")+1,r.length);if(e("#"+t.target.id+":checked").length){var t=o.cookie_expires,s=o.cookie_path,u=o.cookie_domain,a=new Date;a.setTime(a.getTime()+t*864e5);document.cookie=i+"=perma_on; expires="+a.toUTCString()+"; path="+s+"; domain="+u;e("form fieldset label[for="+r+"]",n).addClass("checked")}else{t=o.cookie_path;s=o.cookie_domain;u=new Date;u.setTime(u.getTime()-100);document.cookie=i+"=perma_on; expires="+u.toUTCString()+"; path="+t+"; domain="+s;e("form fieldset label[for="+r+"]",n).removeClass("checked")}});u&&r&&"perma_on"===p.socialSharePrivacy_facebook&&e("li.facebook span.switch",n).click();a&&i&&"perma_on"===p.socialSharePrivacy_twitter&&e("li.twitter span.switch",n).click();f&&h&&"perma_on"===p.socialSharePrivacy_gplus&&e("li.gplus span.switch",n).click()}})}})(jQuery)